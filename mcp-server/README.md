# Tyaprover MCP Server for Claude Code CLI

**AI-Powered Application Deployment and Management**

This MCP (Model Context Protocol) server enables natural language control of your Tyaprover instance through Claude Code CLI. Deploy, manage, and monitor your applications using conversational commands instead of complex CLI syntax.

## üöÄ Quick Start

### 1. Install Dependencies
```bash
npm install
```

### 2. Build the Server
```bash
npm run build
```

### 3. Configure Environment
```bash
# Copy example configuration
cp .env.example .env

# Edit .env with your settings
export TYAPROVER_API_URL="https://captain.toowired.win"
export TYAPROVER_AUTH_TOKEN="your-auth-token-here"
export TYAPROVER_NAMESPACE="captain"
```

### 4. Test the Server
```bash
npm test
```

### 5. Configure Claude CLI
Add to your Claude CLI MCP configuration:
```json
{
  "tyaprover": {
    "command": "node",
    "args": ["./build/index.js"],
    "cwd": "/path/to/tyaprover/mcp-server"
  }
}
```

### 6. Start Using AI Commands
```bash
claude "show me all my deployed applications"
claude "deploy a new Node.js app called my-api using node:18"
claude "what's the status of my database application?"
```

<!-- Generated by Copilot -->

## üõ† How It Works

The Tyaprover MCP server acts as an intelligent bridge between Claude Code CLI and your Tyaprover instance:

```
Claude CLI ‚Üê‚Üí MCP Server ‚Üê‚Üí Tyaprover REST API ‚Üê‚Üí Your Applications
```

1. **You speak naturally**: "Deploy a React app called portfolio"
2. **Claude understands**: Parses intent and extracts parameters
3. **MCP server translates**: Converts to Tyaprover API calls
4. **Action happens**: Your app gets deployed
5. **You get feedback**: Success confirmation or error details

## üéØ Available AI Commands

### Application Management
- **"List all my applications"** ‚Üí Shows all deployed apps with status
- **"Show me details for [app-name]"** ‚Üí Detailed app configuration
- **"Deploy a new app called [name] using [image]"** ‚Üí Creates and deploys app

### Natural Language Examples
```bash
# List applications
claude "What apps do I have running?"
claude "Show me my deployed services"

# Get app information
claude "Tell me about my API server"
claude "What's the configuration of my database?"

# Deploy new applications
claude "Deploy nginx as a load balancer called gateway"
claude "Create a MongoDB service using mongo:latest"
claude "Deploy a Python Flask app called user-service"
```

See [API.md](./API.md) for complete tool documentation.

## üìã Prerequisites

Before you begin, ensure you have:

### System Requirements
- **Node.js 18+** and npm
- **Running Tyaprover Instance** (accessible over network)
- **Claude Code CLI** (`npm install -g @anthropic-ai/claude-code`)
- **Valid Auth Token** for your Tyaprover instance

### Getting Your Auth Token
1. Log into Tyaprover web interface
2. Open browser developer tools (F12)
3. Go to Network tab
4. Make any action (like viewing apps)
5. Find a request and copy the `x-captain-auth` header value

<!-- Generated by Copilot -->

## Setup and Running the Tyaprover MCP Server

The MCP server is typically launched automatically by the Claude Code CLI based on your `mcp-config.json`. However, you'll need to build it first.

1.  **Navigate to the MCP Server Directory:**
    ```bash
    cd /path/to/your/caprover-project/mcp-server/
    ```

2.  **Install Dependencies:**
    ```bash
    npm install
    ```

3.  **Build the Server:**
    ```bash
    npm run build
    ```
    This command compiles the TypeScript source code into JavaScript in the `mcp-server/build/` directory and makes the `build/index.js` file executable.

4.  **Manual Testing (Optional):**
    You can test run the server manually to see if it starts, but it won't do much without being called by an MCP client (like Claude CLI).
    ```bash
    # Ensure these are set in your environment for manual testing:
    # export TYAPROVER_API_URL="https://captain.your-domain.com"
    # export TYAPROVER_AUTH_TOKEN="your-auth-token"
    # export TYAPROVER_NAMESPACE="captain"
    npm start
    ```
    You should see a message like "Tyaprover MCP Server running on stdio..." in the console error stream. Press `Ctrl+C` to stop.

## Configuring Claude Code CLI (`mcp-config.json`)

To enable the Claude Code CLI to use your Tyaprover MCP server, you need to create or update an `mcp-config.json` file. This file tells Claude CLI how to launch your server.

**Location:** You can place this file anywhere, for example, in your user's Claude configuration directory (e.g., `~/.claude/mcp-config.json` on Linux/macOS) or in your project directory. You will then specify its path when running `claude`.

**Content:**

```json
{
  "mcpServers": {
    "tyaprover": {
      "command": "node",
      "args": [
        "/absolute/path/to/your/caprover-project/mcp-server/build/index.js"
      ],
      "env": {
        "TYAPROVER_API_URL": "https://captain.your-caprover-domain.com",
        "TYAPROVER_AUTH_TOKEN": "your-long-lived-caprover-auth-token",
        "TYAPROVER_NAMESPACE": "captain",
        "CAPROVER_API_VERSION": "v2"
      }
    }
  }
}
```

**Key fields to customize:**

*   **`command`**: Should generally be `"node"`.
*   **`args[0]`**: **Crucial!** Replace `/absolute/path/to/your/caprover-project/mcp-server/build/index.js` with the correct, absolute path to the compiled `index.js` file of *your* Tyaprover MCP server.
*   **`env.TYAPROVER_API_URL`**: Your Tyaprover instance's base URL (e.g., `http://localhost:3000` or `https://captain.yourdomain.com`).
*   **`env.TYAPROVER_AUTH_TOKEN`**: Your valid `x-captain-auth` token.
*   **`env.TYAPROVER_NAMESPACE`**: Usually `"captain"`.
*   **`env.CAPROVER_API_VERSION`**: The API version your CapRover instance uses (e.g., "v2").

**Usage with Claude CLI:**

```bash
claude --mcp-config /path/to/your/mcp-config.json "Your prompt here"
```
Or, in interactive mode:
```bash
claude --mcp-config /path/to/your/mcp-config.json
> Your prompt for Tyaprover
```

## Available Tools

The Tyaprover MCP server currently exposes the following tools (this list will grow as more tools are implemented):

*   **`tyaprover/listApps`**:
    *   Description: Lists all deployed applications.
    *   Inputs: None.
    *   Output: JSON array of application definitions.
*   **`tyaprover/getAppDetails`**:
    *   Description: Gets detailed information for a specific application.
    *   Inputs: `appName` (string).
    *   Output: JSON object of the application definition.
*   **`tyaprover/deployNewApp`**:
    *   Description: Deploys a new application or updates an existing one.
    *   Inputs: `appName` (string), `imageName` (string), `instanceCount` (optional number), `environmentVariables` (optional array of key-value pairs), `portMappings` (optional array), `volumes` (optional array), etc.
    *   Output: Text confirmation.
*   **`tyaprover/deleteApp`**:
    *   Description: Deletes an application. This is a destructive operation.
    *   Inputs: `appName` (string).
    *   Output: Text confirmation.
*   **`tyaprover/setAppEnvironmentVariables`**:
    *   Description: Sets or updates environment variables for an application. This replaces all existing variables with the provided set.
    *   Inputs:
        *   `appName` (string)
        *   `environmentVariables` (array of objects, each with `key` and `value` strings)
    *   Output: Text confirmation.
*   **`tyaprover/scaleApp`**:
    *   Description: Changes the number of running instances for an application.
    *   Inputs:
        *   `appName` (string)
        *   `instanceCount` (number, 0 to stop)
    *   Output: Text confirmation.
*   **`tyaprover/enableAppSsl`**:
    *   Description: Enables SSL (HTTPS) for an application by attaching a custom domain.
    *   Inputs:
        *   `appName` (string)
        *   `customDomain` (string)
    *   Output: Text confirmation.
*   **`tyaprover/removeCustomDomain`**:
    *   Description: Removes a custom domain from an application.
    *   Inputs:
        *   `appName` (string)
        *   `customDomain` (string)
    *   Output: Text confirmation.

*(More tools like `deleteApp`, `setAppEnvironmentVariables`, `scaleApp`, `enableAppSsl`, `removeCustomDomain` are planned).*

## Example Prompts

Here are some ways you might prompt Claude to use these tools:

*   `"List all my apps in Tyaprover."` (Uses `tyaprover/listApps`)
*   `"Get details for the app 'my-api' in Tyaprover."` (Uses `tyaprover/getAppDetails`)
*   `"Deploy a new Tyaprover app named 'blog' from the image 'wordpress:latest'. Give it 1 instance and expose container port 80."` (Uses `tyaprover/deployNewApp`)
*   `"Update the 'blog' app in Tyaprover to use the image 'wordpress:5.8' and set an environment variable 'WP_DEBUG' to 'true'."` (Uses `tyaprover/deployNewApp` for updates)

Claude will interpret your natural language and attempt to call the appropriate tool with the correct parameters.

## Troubleshooting

*   **"Command not found" or server doesn't start:**
    *   Ensure the `command` and `args` path in `mcp-config.json` correctly point to your executable `mcp-server/build/index.js`.
    *   Make sure `node` is installed and in your PATH.
    *   Check permissions on `mcp-server/build/index.js` (it should be executable, `npm run build` attempts to set this).
*   **Authentication Errors / API Errors:**
    *   Verify `TYAPROVER_API_URL` and `TYAPROVER_AUTH_TOKEN` in `mcp-config.json` are correct and the token is still valid.
    *   The MCP server logs errors to `console.error()`. When Claude CLI runs it, these logs might appear in Claude's own logs or terminal output, depending on Claude CLI's verbosity and error handling. Check the `mcp-server-tyaprover.log` file if using Claude Desktop.
*   **Tool Not Found / Incorrect Parameters:**
    *   Ensure your prompt is clear.
    *   Check the tool definitions in `mcp-server/src/index.ts` if you suspect an issue with how tools are defined or named.
